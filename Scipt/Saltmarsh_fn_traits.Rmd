---
title: "Saltmarsh_fn_traits"
author: "Dana Lanceman"
date: "2023-09-12"
output: html_document
editor_options: 
  chunk_output_type: console
---

# 1. Set up

```{r Load packages}
#install.packages("readxl")
#install.packages("tidyverse")
#install.packages("lme4")
#install.packages("MuMIn")

library(readxl)
library(tidyverse)
library(lme4)
library(MuMIn)
```


```{r Get data}
# set working directory
setwd("C:/Users/z5204897/OneDrive - UNSW/Desktop/PhD/Data_analysis/Project/Functional_traits")

# input saltmarsh data
salt <- read_excel("Data/Functional_traits_combined_data.xlsx", sheet = "Saltmarsh") %>% 
  arrange(Date, Time) %>% 
  mutate(total_stems = Stems * 10000/Quad_length_cm^2, # add column for total stem count per 1m2 for each species to standardise stem counts
         rest_year = case_when(
           Site == "AE" ~ as.numeric("2017"),
           Site == "HS" ~ as.numeric("2008"),
           Site == "TA" ~ as.numeric("2007"),
           Site == "TB" ~ as.numeric("2012"),
           Site == "CC" ~ as.numeric("1990"),
           Site == "CF" ~ as.numeric("1993"),
           Site == "DLW" ~ as.numeric("2014")
         )) # add a column for restoration years
# double check with Will years for each
```


# 2. Explore data - Sites, Species, Restoration

```{r Explore non-species-specific data}
# plot by order of observation
plot(salt$Canopy_ht_cm)
plot(salt$Burrows_0.5x0.5)
plot(salt$`Total_cover_%`)

# plot by site
new_order <- with(salt, reorder(Site, Canopy_ht_cm, median, na.rm=T)) 
boxplot(Canopy_ht_cm ~ new_order, data = salt)

new_order <- with(salt, reorder(Site, Burrows_0.5x0.5, median, na.rm=T)) 
boxplot(Burrows_0.5x0.5 ~ new_order, data = salt)

new_order <- with(salt, reorder(Site, `Total_cover_%`, median, na.rm=T)) 
boxplot(`Total_cover_%` ~ new_order, data = salt)
```


this chunk isn't very relevant for anything
```{r Exploring potential overall changes in species-specific traits}
# plot each variable by order recorded
plot(salt$total_stems)
plot(salt$`Sp_cover_%`)
# need to fix first and then do flowers and seeds too plot(spor$Buds)
plot(salt$Stem_ht_mm)
plot(salt$Stem_dia_mm)

# plot by Site
new_order <- with(salt, reorder(Site, total_stems, median, na.rm=T)) 
boxplot(total_stems ~ new_order, data = salt)
# not really a relevant metric on a non-species-specific level as we measured stems differently for different species.

new_order <- with(salt, reorder(Site, `Sp_cover_%`, median, na.rm=T)) 
boxplot(`Sp_cover_%` ~ new_order, data = salt)
# not really a relevant metric on a non-species-specific level as it's more a function of how many species there are

new_order <- with(salt, reorder(Site, Stem_ht_mm, median, na.rm=T)) 
boxplot(Stem_ht_mm ~ new_order, data = salt)
# shorter for Maroochy, no clear trends with restoration

new_order <- with(salt, reorder(Site, Stem_dia_mm, median, na.rm=T)) 
boxplot(Stem_dia_mm ~ new_order, data = salt)
# no clear trends


# plot relationships between variables
plot(salt$Stem_ht_mm, salt$Stem_dia_mm)
plot(salt$total_stems, salt$`Sp_cover_%`)
```

```{r Create species-specific dataframes}
spor <- salt %>%
  filter(Species == "Sporobolus")

sarc <- salt %>%
  filter(Species == "Sarcocornia")

trig <- salt %>%
  filter(Species == "Triglochin")

pneu <- salt %>%
  filter(Species == "Pneumatophores")

# list all species
unique(salt$Species)

junc.k <- salt %>% 
  filter(Species == "Juncus_kraussii")

aster <- salt %>% 
  filter(Species == "Aster")

```


```{r By species - Sporobolus}
# plot each variable by order recorded
plot(spor$total_stems)
plot(spor$`Sp_cover_%`)
# need to fix first and then do flowers and seeds too plot(spor$Buds)
plot(spor$Stem_ht_mm)
plot(spor$Stem_dia_mm)

# plot by Site
new_order <- with(spor, reorder(Site, total_stems, median, na.rm=T)) 
boxplot(total_stems ~ new_order, data = spor)

new_order <- with(spor, reorder(Site, `Sp_cover_%`, median, na.rm=T)) 
boxplot(`Sp_cover_%` ~ new_order, data = spor)

new_order <- with(spor, reorder(Site, Stem_ht_mm, median, na.rm=T)) 
boxplot(Stem_ht_mm ~ new_order, data = spor)

new_order <- with(spor, reorder(Site, Stem_dia_mm, median, na.rm=T)) 
boxplot(Stem_dia_mm ~ new_order, data = spor)


# plot relationships between variables
plot(spor$Stem_ht_mm, spor$Stem_dia_mm)
plot(spor$total_stems, spor$`Sp_cover_%`)
```

```{r By species - Sarcocornia}
# plot each variable by order recorded
plot(sarc$total_stems)
plot(sarc$`Sp_cover_%`)
# need to fix first and then do flowers and seeds too plot(spor$Buds)
plot(sarc$Stem_ht_mm)
plot(sarc$Stem_dia_mm)

# plot by Site
new_order <- with(sarc, reorder(Site, total_stems, median, na.rm=T)) 
boxplot(total_stems ~ new_order, data = sarc)

new_order <- with(sarc, reorder(Site, `Sp_cover_%`, median, na.rm=T)) 
boxplot(`Sp_cover_%` ~ new_order, data = sarc)

new_order <- with(sarc, reorder(Site, Stem_ht_mm, median, na.rm=T)) 
boxplot(Stem_ht_mm ~ new_order, data = sarc)

new_order <- with(sarc, reorder(Site, Stem_dia_mm, median, na.rm=T)) 
boxplot(Stem_dia_mm ~ new_order, data = sarc)


# plot relationships between variables
plot(sarc$Stem_dia_mm, sarc$Stem_ht_mm)
plot(sarc$total_stems, sarc$`Sp_cover_%`)
```


```{r By species - Triglochin}

# plot each variable by order recorded
plot(trig$total_stems)
plot(trig$`Sp_cover_%`)
# need to fix first and then do flowers and seeds too plot(spor$Buds)
plot(trig$Stem_ht_mm)
plot(trig$Stem_dia_mm)

# plot by Site
new_order <- with(trig, reorder(Site, total_stems, median, na.rm=T)) 
boxplot(total_stems ~ new_order, data = trig)

new_order <- with(trig, reorder(Site, `Sp_cover_%`, median, na.rm=T)) 
boxplot(`Sp_cover_%` ~ new_order, data = trig)

new_order <- with(trig, reorder(Site, Stem_ht_mm, median, na.rm=T)) 
boxplot(Stem_ht_mm ~ new_order, data = trig)

new_order <- with(trig, reorder(Site, Stem_dia_mm, median, na.rm=T)) 
boxplot(Stem_dia_mm ~ new_order, data = trig)


# plot relationships between variables
plot(trig$Stem_dia_mm, trig$Stem_ht_mm)
plot(trig$total_stems, trig$`Sp_cover_%`)
```

```{r By species - Pneumatophores}

# plot each variable by order recorded
plot(pneu$total_stems)
plot(pneu$`Sp_cover_%`)
# need to fix first and then do flowers and seeds too plot(spor$Buds)
plot(pneu$Stem_ht_mm)
plot(pneu$Stem_dia_mm)

# plot by Site
new_order <- with(pneu, reorder(Site, total_stems, median, na.rm=T)) 
boxplot(total_stems ~ new_order, data = pneu)

new_order <- with(pneu, reorder(Site, `Sp_cover_%`, median, na.rm=T)) 
boxplot(`Sp_cover_%` ~ new_order, data = pneu)

new_order <- with(pneu, reorder(Site, Stem_ht_mm, median, na.rm=T)) 
boxplot(Stem_ht_mm ~ new_order, data = pneu)

new_order <- with(pneu, reorder(Site, Stem_dia_mm, median, na.rm=T)) 
boxplot(Stem_dia_mm ~ new_order, data = pneu)


# plot relationships between variables
plot(pneu$Stem_dia_mm, pneu$Stem_ht_mm)
plot(pneu$total_stems, pneu$`Sp_cover_%`)
```


# 3. Explore data - Elevation

```{r Elevation - all saltmarsh variables}
plot(Canopy_ht_cm ~ Elevation, salt) # no clear trends
plot(Burrows_0.5x0.5 ~ Elevation, salt) # burrows seem to mostly exist above ~0.5m elevation
plot(`Total_cover_%` ~ Elevation, salt) # no clear trends
```

```{r Elevation - sporobolus}
plot(total_stems ~ Elevation, spor) # looks roughly like a positive relationship
plot(`Sp_cover_%` ~ Elevation, spor) # potentially a slight positive relationship?
# need to fix first and then do flowers and seeds too plot(spor$Buds)
plot(Stem_ht_mm ~ Elevation, spor) # looks like a negative relationship
plot(Stem_dia_mm ~ Elevation, spor) # no clear trend
```


```{r Elevation - Sarcocornia}
plot(total_stems ~ Elevation, sarc) # no clear trend
plot(`Sp_cover_%` ~ Elevation, sarc) # maybe a negative relationship or no clear trend
# need to fix first and then do flowers and seeds too plot(spor$Buds)
plot(Stem_ht_mm ~ Elevation, sarc) # no clear trend
plot(Stem_dia_mm ~ Elevation, sarc) # no clear trend
```


```{r Elevation - Triglochin}
plot(total_stems ~ Elevation, trig) # no clear trend
plot(`Sp_cover_%` ~ Elevation, trig) #  no clear trend
# need to fix first and then do flowers and seeds too plot(spor$Buds)
plot(Stem_ht_mm ~ Elevation, trig) # no clear trend
plot(Stem_dia_mm ~ Elevation, trig) # no clear trend
```


```{r Elevation - Pneumatophores}
plot(total_stems ~ Elevation, pneu) # no clear trend
plot(`Sp_cover_%` ~ Elevation, pneu) #  no clear trend
plot(Stem_ht_mm ~ Elevation, pneu) # no clear trend
plot(Stem_dia_mm ~ Elevation, pneu) # no clear trend
```


#4. Test model assumptions

To create linear mixed effects models and generalised mixed models, we need to test if the data conform to model assumptions.

For linear mixed effects models, these are:
- linear relationship between predictor and response variable
- model residuals are normally distributed
- model residuals have equal variances
- model residuals are independent

We also need to identify any unrealistic outliers in the dataset so they can be removed prior to analysis. These are identified below using cleveland plots.

Normality of response variables is not required but is checked below using histograms, boxplots and cleveland plots.

```{r Identify outliers and explore distributions - side-by-side Cleveland plot and boxplot}
cleveland_plot <- function(vector,axislab){
  par(mfrow= c(1,2), mar = c(5,4,2,1)) # set some parameters for the plot
  boxplot(vector,  ylab = axislab)
  dotchart(vector, xlab = axislab,
         ylab = "Order of the data") 
}

# all species
cleveland_plot(salt$Canopy_ht_cm, "Canopy height (cm)") # right skewed, has outliers but values are realistic
cleveland_plot(salt$`Total_cover_%`, "Total cover (%)") # left skewed, has outliers but values should be realistic
cleveland_plot(salt$Burrows_0.5x0.5, "Number of burrows") # right skewed (and zero inflated), has outliers but values are realistic

# sporobolus
cleveland_plot(spor$`Sp_cover_%`, "Species cover (%)") # somewhat left skewed but decent. No outliers
cleveland_plot(spor$Stem_ht_mm, "Stem height (mm)") # there are only a few values with height >600. When investigating- this is realistic for each large height value. Overall the distribution is fairly evenly spread.
cleveland_plot(spor$Stem_dia_mm, "Stem diameter (mm)") # right skewed. There are some very large values that need investigating - plant net doesn't state the regular stem diameter so don't exclude. They are little overestimates, and the 0.1mm measurements are likely too low, but should be OK and no reason to remove, so retain.
cleveland_plot(spor$total_stems, "Stem density (number of stems)") # right skewed

# sarcocornia
cleveland_plot(sarc$`Sp_cover_%`, "Species cover (%)") # evenly spread, no outliers
cleveland_plot(sarc$Stem_ht_mm, "Stem height (mm)") # evenly distributed. One relatively large value but it is realistic. Two relatively small values but realistic.
cleveland_plot(sarc$Stem_dia_mm, "Stem diameter (mm)") # slightly right skewed but very acceptable distribution. Three larger values but realistic
cleveland_plot(sarc$total_stems, "Stem density (number of stems)") # right skewed, some relatively high values but realistic

# triglochin
cleveland_plot(trig$`Sp_cover_%`, "Species cover (%)") # very right skewed. Potential outlier high extreme value - checked photo and this is accurate.
cleveland_plot(trig$Stem_ht_mm, "Stem height (mm)") # fairly evenly distributed except some very high potential outliers. There's no evidence for stems as high as 860mm or 556mm in photos and according to plantnet this species only grows to ~30cm, so 860 and 556 are likely data errors. Other high measurements are likely OK.
cleveland_plot(trig$Stem_dia_mm, "Stem diameter (mm)") # there are some extreme outliers that need investigating. According to plantnet, leaf diameters (what we're calling stems) are usually 1-3mm. 7 out of 8 extreme values of 4 or more are from the same quadrat - potentially a consistent error with measuring there. These extreme values should be removed. The distribution is inflated by values of 1.
cleveland_plot(trig$total_stems, "Stem density (number of stems)") # one extreme value but realistic. somewhat right skewed (mostly because of this value)

# pneumatophores
cleveland_plot(pneu$`Sp_cover_%`, "Species cover (%)") # right skewed with one extreme high value. This is potentially an overestimate, looking at photos. But photos don't make re-estimation very easy. So leave for now. I also think pneumatophore cover is a fairly irrelevant metric as they're usually covered by saltmarsh and end up with 0% cover, which doesn't tell us anything.
cleveland_plot(pneu$Stem_ht_mm, "Stem height (mm)") # evenly distributed, no outliers
cleveland_plot(pneu$Stem_dia_mm, "Stem diameter (mm)") # evenly distributed, one potential low outlier. This value is unrealistic and should be removed.
cleveland_plot(pneu$total_stems, "Stem density (number of stems)") # right skewed. One potential high outlier, but it's realistic 
```

```{r Less common species - check potential data issues from notes}
# Juncus - need to investigate consistency of stem measurements
cleveland_plot(junc.k$Stem_ht_mm, "Stem height (mm)") # looks great
cleveland_plot(junc.k$Stem_dia_mm, "Stem diameter (mm)") # 2 of last (top) three look a bit large, but these weren't the data points I made a potential note about and they are close to plant net's guidelines for width (1.8-4.5mm), so retain. Slight right skew.

# Aster - need to investigate stem height (potentially measured to the flower before 4:08pm 18/4/23)
cleveland_plot(aster$Stem_ht_mm, "Stem height (mm)") # balanced distribution. there are no very high measurements after around the first 1/3 of data points. However, there are only 12 data points before 4:08pm 18/4/23 so there are large data points after this. We don't know how much to offset potential flower measurements so should retain with care.
```


```{r Trying transformations}
# do transformations fix skew?
cleveland_plot(log(salt$Canopy_ht_cm), "log Canopy height (cm)") # skew is fixed with log transformation
cleveland_plot(log(salt$`Total_cover_%`), "log Total cover (%)") # log transform makes this worse
cleveland_plot(sqrt(salt$`Total_cover_%`), "sqrt Total cover (%)") # sqrt transform makes this worse
cleveland_plot(log(salt$Burrows_0.5x0.5 +1), "log Number of burrows") # better, but always will be zero-inflated
cleveland_plot(sqrt(salt$Burrows_0.5x0.5), "sqrt Number of burrows") # similar to log transform

cleveland_plot(log(spor$`Sp_cover_%` + 1), "log Species cover (%)") # much worse than original
cleveland_plot(sqrt(spor$`Sp_cover_%`), "sqrt Species cover (%)") # worse than original
cleveland_plot(log(spor$Stem_ht_mm), "log Stem height (mm)") # much more even spread. better
cleveland_plot(log(spor$Stem_dia_mm), "log Stem diameter (mm)") # much more even spread. better
cleveland_plot(sqrt(spor$Stem_dia_mm), "sqrt Stem diameter (mm)") # similar to original. log is better.
cleveland_plot(log(spor$total_stems), "log Stem density (number of stems)") # more skewed than original
cleveland_plot(sqrt(spor$total_stems), "sqrt Stem density (number of stems)") # even spread now.

cleveland_plot(log(sarc$Stem_dia_mm), "log Stem diameter (mm)") # comperable / no less skewed than original
cleveland_plot(sqrt(sarc$Stem_dia_mm), "sqrt Stem diameter (mm)") # similar to original but slightly more evenly spread so could be a slight improvement (original was fine anyway)
cleveland_plot(log(sarc$total_stems), "log Stem density (number of stems)") # becomes left skewed instead, but more even than original
cleveland_plot(sqrt(sarc$total_stems), "sqrt Stem density (number of stems)") # quite evenly distributed. Use this one.

cleveland_plot(log(trig$`Sp_cover_%` +1), "log Species cover (%)") # evenly distributed now
cleveland_plot(log(trig$Stem_dia_mm), "log Stem diameter (mm)") # not really an improvement
cleveland_plot(sqrt(trig$Stem_dia_mm), "sqrt Stem diameter (mm)") # more evenly distributed
cleveland_plot(log(trig$total_stems), "log Stem density (number of stems)") # improvement
cleveland_plot(sqrt(trig$total_stems), "sqrt Stem density (number of stems)") # improvement, probably somewhat worse than the log transform

cleveland_plot(log(pneu$`Sp_cover_%` +1), "log Species cover (%)") # still skewed but less skewed
cleveland_plot(sqrt(pneu$`Sp_cover_%`), "sqrt Species cover (%)") # only a little skewed now, acceptable
cleveland_plot(log(pneu$total_stems), "log Stem density (number of stems)") # improvement, but now a little left skewed
cleveland_plot(sqrt(pneu$total_stems), "sqrt Stem density (number of stems)") # evenly spread
```

Therefore:
- log-transform: canopy height, sporobolus stem height, sporobolus stem diameter, triglochin species cover, trig stem density
- sqrt-transform: sporobolus stem density, sarc stem diameter, sarc total stems, triglochin stem diameter, pneu sp cover, pneu total stems
- Don't need transforming: sporobolus species cover, sarcocornia species cover, sarc stem height, triglochin stem height (just needs extreme values removed), pneumatophore stem height, pneu stem diameter
- Transforms don't help: total cover, burrows (zero-inflated), sporobolus species cover

```{r Transforming data and removing unrealistic outliers}
# all saltmarsh
salt$ln.canopy.ht <- log(salt$Canopy_ht_cm)

# sporobolus
spor$ln.stem.ht <- log(spor$Stem_ht_mm)
spor$ln.stem.dia <- log(spor$Stem_dia_mm)
spor$sq.stem.dens <- sqrt(spor$total_stems)

# sarcocornia
sarc$sq.stem.dia <- sqrt(sarc$Stem_dia_mm)
sarc$sq.stem.dens <- sqrt(sarc$total_stems)

# triglochin
trig[121,19] <- NA # this value had stem height of 556mm
trig[240,19] <- NA # this value had stem height of 860mm
trig[c(98:104),20] <- NA # these had stem diameters > 4mm
trig[78,20] <- NA # stem diameter was > 4mm
trig$ln.sp.cover <- log(trig$`Sp_cover_%` + 1)
trig$sq.stem.dia <- sqrt(trig$Stem_dia_mm)
trig$ln.stem.dens <- log(trig$total_stems)

# pneumatophores
pneu[40,20] <- NA # this had stem diameter of 1mm
pneu$sq.sp.cover <- sqrt(pneu$`Sp_cover_%`)
pneu$sq.stem.dens <- sqrt(pneu$total_stems)
```

```{r Histograms}
# overall saltmarsh - log canopy height
ggplot(salt, aes(x = ln.canopy.ht)) +
  geom_histogram() # looks normally distributed

# sporobolus - species cover, log stem height, log stem diameter, sqrt stem density
ggplot(spor, aes(x = `Sp_cover_%`)) +
  geom_histogram() # not normally distibuted. very left skewed. transformations didn't help.
ggplot(spor, aes(x = ln.stem.ht)) +
  geom_histogram() # looks close enough to normal
ggplot(spor, aes(x = ln.stem.dia)) +
  geom_histogram(binwidth = 0.5) # looks close enough to normal
ggplot(spor, aes(x = sq.stem.dens)) +
  geom_histogram(binwidth=10) # looks close enough to normal

# sarcocornia - species cover, stem height, sqrt stem diameter, sqrt stem density
ggplot(sarc, aes(x = `Sp_cover_%`)) +
  geom_histogram() # not normally distributed
ggplot(sarc, aes(x = Stem_ht_mm)) +
  geom_histogram() # looks normal
ggplot(sarc, aes(x = sq.stem.dia)) +
  geom_histogram(binwidth = 0.2) # looks close enough to normal
ggplot(sarc, aes(x = sq.stem.dens)) +
  geom_histogram(binwidth=2) # somewhat right skewed but hopefully close enough

# triglochin - log species cover, stem height, sqrt stem diameter, sqrt stem density
ggplot(trig, aes(x = ln.sp.cover)) +
  geom_histogram() # not normally distributed
ggplot(trig, aes(x = Stem_ht_mm)) +
  geom_histogram() # looks normal
ggplot(trig, aes(x = sq.stem.dia)) +
  geom_histogram(binwidth = 0.1) # looks close enough to normal
ggplot(trig, aes(x = ln.stem.dens)) +
  geom_histogram() # slightly left skewed but ok

# pneumatophores - sqrt species cover, stem height, stem diameter, sqrt stem density
ggplot(pneu, aes(x = sq.sp.cover)) +
  geom_histogram() # not normal
ggplot(pneu, aes(x = Stem_ht_mm)) +
  geom_histogram() # normal
ggplot(pneu, aes(x = Stem_dia_mm)) +
  geom_histogram(binwidth = 0.5) # normal
ggplot(pneu, aes(x = sq.stem.dens)) +
  geom_histogram() # looks close enough to normal
```

Probably need non-parametric tests:
- Overall saltmarsh: Total cover, burrows
- Sporobolus: Species cover
- Sarcocornia: Species cover
- Triglochin: Species cover
- Pneumatophores: Species cover
- Reproduction for all!

These are proportions (covers) and zero-inflated (burrows) and binary (reproduction)

(note that normal distribution is of residuals only, rather than for each raw variable, so check that first)

```{r Scatterplots - check for no relationships between predictors}
# Restoration age x Elevation (?)
ggplot(salt, aes(rest_year, Elevation)) +
  geom_point() # no  correlation
```

# 5. Model Building

Further assumptions require model building and are looked into below, with code adapted from https://www.ssc.wisc.edu/sscc/pubs/MM/MM_DiagInfer.html

Notes on interpreting diagnostic plots:

- plot():
    - linearity of residuals: is the mean of the residuals approximately zero for each value of the predictor?
    - equal variances: is there an equal spread of data points along fitted values?
    - asymmetry of residuals: are positive and negative tails similar in amplitude?
    - see https://stats.stackexchange.com/questions/242517/interpretation-of-residual-plot-for-mixed-effect-linear-model
    
- linear model for predictor variables:
    - no non-linear trends in the plot

- qqnorm plot:
    - approx x = y plot, no strong deviations
    
- values with strong leverage:
    - all values have similar leverage
    
To build our models, we are representing random factors in this format: (1|RandomFactor) and fixed factors in this format: FixedFactor. Interactions are represented with asterisks.

For us, restoration year is a fixed factor (although not all points have this - need to investigate). Elevation is also fixed. Site and quadrat are random factors. Quadrat is nested within site - so the same quadrat number is irrelevant between sites - how to best represent this?

```{r Diagnostic plots - saltmarsh log canopy height}
M <- lmer(ln.canopy.ht ~ Elevation + (1|Site) * (1|Quadrat), data=salt, REML= FALSE)
# set R's global handling of NA values = function doesn't fun with NAs. this seems necessary for "dredge" to work correctly.
options(na.action = "na.fail")
# dredge creates a model selection table with different combinations of fixed effects
d <- dredge(M)
# change this option back so it doesn't impact other functions in R
options(na.action = "na.omit")
# view dredge results
tab_df(d,use.viewer = T)

# average the models with delta values less than 2 (all similarly good fits)
M.avg.GP <- model.avg(d,fit=TRUE,subset = delta < 2)

# visualise the results of averaged model
tab_model(
    M.avg.GP,
    show.ci = FALSE, # showing confidence intervals
    show.se = TRUE, # showing standard errors
    auto.label = T, # labels factors in a "prettier" way
    string.se = "SE", # title of the standard error column
    show.icc = FALSE, # showing intraclass correlation coefficient for mixed models
    dv.labels = c("Insect damage") # list of dependent variables
    )

# predict effects of inundation when controlling for the other factors
predict_Inun <- ggemmeans(M, terms = c("s.Inundation.300m [all]"))
# view this result
print(predict_Inun)
# visualise this result
I.I <- plot(predict_Inun, ci = T,add.data = TRUE, dot.alpha = 1,  jitter = 0) +
  ggtitle("") +  geom_line(size = 1.2) +
  labs(y = "Insect damage", x = "") +
  theme_classic() +
  theme(text = element_text(size = 32),
        axis.text = element_text(size = 26)) 

  # predict effects of stem density when controlling for other factors
predict_stemdens <- ggemmeans(M, terms = c("L.Stem.density [all]"))
print(predict_stemdens)
S.I <- plot(predict_stemdens, ci = T,add.data = TRUE, dot.alpha = 1,  jitter = 0) +
  ggtitle("") +  geom_line(size = 1.2) +
  labs(y = "Insect damage*", x = "") +
  theme_classic() +
  theme(text = element_text(size = 32),
        axis.text = element_text(size = 26)) 
  
  # predict effects of elevation when controlling for other factors
predict_elev <- ggemmeans(M, terms = c("Elevation [all]"))
print(predict_elev)
E.I <- plot(predict_elev, ci = T,add.data = TRUE, dot.alpha = 1,  jitter = 0)  +
  ggtitle("") +  geom_line(size = 1.2) +
  labs(y = "Insect damage*", x = "") +
  theme_classic() +
  theme(text = element_text(size = 32),
        axis.text = element_text(size = 26)) 
```

